// <auto-generated />

using HraBot.Core;
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.ChangeTracking.Internal;
using Microsoft.EntityFrameworkCore.Diagnostics;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Infrastructure.Internal;
using Microsoft.EntityFrameworkCore.Internal;
using Microsoft.EntityFrameworkCore.Metadata;
using Microsoft.EntityFrameworkCore.Query;
using Microsoft.EntityFrameworkCore.Query.Internal;
using Microsoft.EntityFrameworkCore.Storage;
using Microsoft.EntityFrameworkCore.Storage.Internal;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using System.Collections.Concurrent;
using System.Collections.Generic;
using System.Data;
using System.Data.Common;
using System.Linq;
using System.Linq.Expressions;
using System.Reflection;
using System.Runtime.CompilerServices;
using System.Threading.Tasks;

#pragma warning disable EF9100 // Precompiled query is experimental

namespace Microsoft.EntityFrameworkCore.GeneratedInterceptors
{
    file static class EntityFrameworkCoreInterceptors
    {
        #region Query1

        [InterceptsLocation(@"/Users/connor/Fiddle/HraBot/src/HraBot.Core/Features/Chat/Chat.cs", 59, 28)]
        public static global::Microsoft.EntityFrameworkCore.Query.IIncludableQueryable<TEntity,TProperty> Query1_Include1<TEntity, TProperty>(this global::System.Linq.IQueryable<TEntity> source, global::System.Linq.Expressions.Expression<global::System.Func<TEntity,TProperty>> navigationPropertyPath)
        where TEntity : class
        {
            var precompiledQueryContext = new PrecompiledQueryContext<TEntity>(((IInfrastructure<DbContext>)source).Instance);
            return precompiledQueryContext.ToIncludable<TProperty>();
        }

        [InterceptsLocation(@"/Users/connor/Fiddle/HraBot/src/HraBot.Core/Features/Chat/Chat.cs", 60, 14)]
        public static global::System.Threading.Tasks.Task<TSource?> Query1_FirstOrDefaultAsync2<TSource>(this global::System.Linq.IQueryable<TSource> source, global::System.Linq.Expressions.Expression<global::System.Func<TSource,global::System.Boolean>> predicate, global::System.Threading.CancellationToken cancellationToken)
        {
            var precompiledQueryContext = (PrecompiledQueryContext<TSource>)source;
            var queryContext = precompiledQueryContext.QueryContext;
            var binary1 = (BinaryExpression)predicate.Body;
            queryContext.Parameters.Add(
                "localId",
                Expression.Lambda<Func<object?>>(Expression.Convert(binary1.Right, typeof(object)))
                .Compile(preferInterpretation: true)
                .Invoke());
            Query1_Executor ??= Query1_GenerateExecutor(precompiledQueryContext.DbContext, precompiledQueryContext.QueryContext);
            return ((Func<QueryContext, global::System.Threading.Tasks.Task<TSource>>)(Query1_Executor))(queryContext);
        }

        private static object Query1_GenerateExecutor(DbContext dbContext, QueryContext queryContext)
        {
            var relationalModel = dbContext.Model.GetRelationalModel();
            var relationalTypeMappingSource = dbContext.GetService<IRelationalTypeMappingSource>();
            var materializerLiftableConstantContext = new RelationalMaterializerLiftableConstantContext(
                dbContext.GetService<ShapedQueryCompilingExpressionVisitorDependencies>(),
                dbContext.GetService<RelationalShapedQueryCompilingExpressionVisitorDependencies>(),
                dbContext.GetService<RelationalCommandBuilderDependencies>());
            var commandBuilderDependencies = materializerLiftableConstantContext.CommandBuilderDependencies;
            var relationalCommandTemplate = ((IRelationalCommandTemplate)(new RelationalCommand(commandBuilderDependencies, "SELECT c0.\"Id\", c0.\"NumMessages\", c0.\"RowVersion\", m.\"Id\", m.\"AiModel\", m.\"Content\", m.\"ConversationId\", m.\"Role\", m.\"Sequence\"\nFROM (\n    SELECT c.\"Id\", c.\"NumMessages\", c.\"RowVersion\"\n    FROM \"Conversations\" AS c\n    WHERE FALSE\n    LIMIT 1\n) AS c0\nLEFT JOIN \"Messages\" AS m ON c0.\"Id\" = m.\"ConversationId\"\nORDER BY c0.\"Id\"", "SELECT c0.\"Id\", c0.\"NumMessages\", c0.\"RowVersion\", m.\"Id\", m.\"AiModel\", m.\"Content\", m.\"ConversationId\", m.\"Role\", m.\"Sequence\"\nFROM (\n    SELECT c.\"Id\", c.\"NumMessages\", c.\"RowVersion\"\n    FROM \"Conversations\" AS c\n    WHERE FALSE\n    LIMIT 1\n) AS c0\nLEFT JOIN \"Messages\" AS m ON c0.\"Id\" = m.\"ConversationId\"\nORDER BY c0.\"Id\"", new IRelationalParameter[] { })));
            var relationalCommandTemplate0 = ((IRelationalCommandTemplate)(new RelationalCommand(commandBuilderDependencies, "SELECT c0.\"Id\", c0.\"NumMessages\", c0.\"RowVersion\", m.\"Id\", m.\"AiModel\", m.\"Content\", m.\"ConversationId\", m.\"Role\", m.\"Sequence\"\nFROM (\n    SELECT c.\"Id\", c.\"NumMessages\", c.\"RowVersion\"\n    FROM \"Conversations\" AS c\n    WHERE c.\"Id\" = @localId\n    LIMIT 1\n) AS c0\nLEFT JOIN \"Messages\" AS m ON c0.\"Id\" = m.\"ConversationId\"\nORDER BY c0.\"Id\"", "SELECT c0.\"Id\", c0.\"NumMessages\", c0.\"RowVersion\", m.\"Id\", m.\"AiModel\", m.\"Content\", m.\"ConversationId\", m.\"Role\", m.\"Sequence\"\nFROM (\n    SELECT c.\"Id\", c.\"NumMessages\", c.\"RowVersion\"\n    FROM \"Conversations\" AS c\n    WHERE c.\"Id\" = @localId\n    LIMIT 1\n) AS c0\nLEFT JOIN \"Messages\" AS m ON c0.\"Id\" = m.\"ConversationId\"\nORDER BY c0.\"Id\"", new IRelationalParameter[] { new TypeMappedRelationalParameter("localId", "@localId", relationalTypeMappingSource.FindMapping(typeof(long), "bigint", false, false, (int? )(null), false, false, (int? )(null), (int? )(null)), true, ParameterDirection.Input) })));
            var emptyValueBuffer = ValueBuffer.Empty;
            var model = materializerLiftableConstantContext.Dependencies.Model;
            var conversationEntityType = model.FindEntityType("HraBot.Core.Conversation");
            var key = conversationEntityType.FindPrimaryKey();
            var emptySnapshot = Snapshot.Empty;
            var conversationEntityType0 = ((RuntimeEntityType)(conversationEntityType));
            var parentIdentifierLambda = object[] (QueryContext queryContext, DbDataReader dataReader) => new object[]
{
    ((object)(((long? )(dataReader.GetInt64(0)))))
};
            var findNavigation = conversationEntityType.FindNavigation("Messages");
            var messagesNavigation = ((INavigationBase)(findNavigation));
            var messagesNavigationCollectionAccessor = ((IPropertyBase)findNavigation).GetCollectionAccessor();
            var selfIdentifierLambda = object[] (QueryContext queryContext, DbDataReader dataReader) => new object[]
{
    ((object)((dataReader.IsDBNull(3) ? default(long? ) : ((long? )(dataReader.GetInt64(3))))))
};
            var parentIdentifierValueComparers = new Func<object, object, bool>[]
{
    bool (object left, object right) => (left == null ? right == null : right != null && ((long)(left)) == ((long)(right)))
};
            var messageEntityType = model.FindEntityType("HraBot.Core.Message");
            var key0 = messageEntityType.FindPrimaryKey();
            var aiModelProperty = ((IPropertyBase)(((ITypeBase)messageEntityType).FindProperty("AiModel")));
            var roleProperty = ((IPropertyBase)(((ITypeBase)messageEntityType).FindProperty("Role")));
            var messageEntityType0 = ((RuntimeEntityType)(messageEntityType));
            var conversationInverseNavigation = ((INavigationBase)(messageEntityType.FindNavigation("Conversation")));
            return Task<Conversation> (QueryContext queryContext) => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync(SingleQueryingEnumerable.Create(((RelationalQueryContext)(queryContext)), IRelationalCommandTemplate (Dictionary<string, object> parameters) =>
{
    IRelationalCommandTemplate result = default(IRelationalCommandTemplate);
    if (parameters["localId"] == null)
    {
        result = relationalCommandTemplate;
    }
    else
    {
        result = relationalCommandTemplate0;
    }

    return result;
}, (ReaderColumn[])(null), Conversation (QueryContext queryContext, DbDataReader dataReader, ResultContext resultContext, SingleQueryResultCoordinator resultCoordinator) =>
{
    if (resultContext.Values == null)
    {
        IEntityType entityType1 = default(IEntityType);
        bool hasNullKey1 = default(bool);
        var materializationContext1 = new MaterializationContext(in emptyValueBuffer, queryContext.Context);
        var instance1 = default(Conversation);
        var entry1 = queryContext.TryGetEntry(key, new object[] { ((object)(dataReader.GetInt64(0))) }, true, out hasNullKey1);
        if (!(hasNullKey1))
        {
            if (entry1 != default(InternalEntityEntry))
            {
                entityType1 = entry1.EntityType;
                instance1 = ((Conversation)(entry1.Entity));
            }
            else
            {
                var shadowSnapshot1 = emptySnapshot;
                entityType1 = conversationEntityType;
                if (entityType1 == conversationEntityType)
                {
                    var instance = new Conversation();
                    UnsafeAccessor_HraBot_Core_Conversation_Id_Set(instance) = dataReader.GetInt64(0);
                    UnsafeAccessor_HraBot_Core_Conversation_NumMessages_Set(instance) = dataReader.GetInt32(1);
                    UnsafeAccessor_HraBot_Core_Conversation_RowVersion_Set(instance) = dataReader.GetFieldValue<byte[]>(2);
                    if (instance is IInjectableService)
                    {
                        ((IInjectableService)(instance)).Injected(materializationContext1.Context, instance, QueryTrackingBehavior.TrackAll, conversationEntityType0);
                    }

                    instance1 = instance;
                }
                else
                {
                    instance1 = default(Conversation);
                }

                entry1 = (entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(entityType1, instance1, in shadowSnapshot1));
            }
        }

        var entity = instance1;
        resultContext.Values = new object[]
        {
            entity
        };
        RelationalShapedQueryCompilingExpressionVisitor.ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Conversation, Conversation>(0, queryContext, dataReader, resultCoordinator, ((Conversation)(resultContext.Values[0])), parentIdentifierLambda, parentIdentifierLambda, messagesNavigation, messagesNavigationCollectionAccessor, true, true);
    }

    RelationalShapedQueryCompilingExpressionVisitor.ShaperProcessingExpressionVisitor.PopulateIncludeCollection(0, queryContext, dataReader, resultCoordinator, parentIdentifierLambda, parentIdentifierLambda, selfIdentifierLambda, parentIdentifierValueComparers, parentIdentifierValueComparers, parentIdentifierValueComparers, Message (QueryContext queryContext, DbDataReader dataReader, ResultContext resultContext, SingleQueryResultCoordinator resultCoordinator) =>
    {
        IEntityType entityType2 = default(IEntityType);
        bool hasNullKey2 = default(bool);
        var materializationContext2 = new MaterializationContext(in emptyValueBuffer, queryContext.Context);
        var instance2 = default(Message);
        var entry2 = queryContext.TryGetEntry(key0, new object[] { (dataReader.IsDBNull(3) ? default(object) : ((object)(dataReader.GetInt64(3)))) }, false, out hasNullKey2);
        if (!(hasNullKey2))
        {
            if (entry2 != default(InternalEntityEntry))
            {
                entityType2 = entry2.EntityType;
                instance2 = ((Message)(entry2.Entity));
            }
            else
            {
                var shadowSnapshot2 = emptySnapshot;
                entityType2 = messageEntityType;
                if (entityType2 == messageEntityType)
                {
                    var instance = UnsafeAccessor_HraBot_Core_Message_Ctor();
                    UnsafeAccessor_HraBot_Core_Message_Id_Set(instance) = (dataReader.IsDBNull(3) ? default(long) : dataReader.GetInt64(3));
                    UnsafeAccessor_HraBot_Core_Message_AiModel_Set(instance) = (dataReader.IsDBNull(4) ? default(AiModel? ) : ((AiModel? )(((EnumToNumberConverter<AiModel, byte>)(((IReadOnlyProperty)(aiModelProperty)).GetTypeMapping().Converter)).ConvertFromProviderTyped(dataReader.GetByte(4)))));
                    UnsafeAccessor_HraBot_Core_Message_Content_Set(instance) = (dataReader.IsDBNull(5) ? default(string) : dataReader.GetString(5));
                    UnsafeAccessor_HraBot_Core_Message_ConversationId_Set(instance) = (dataReader.IsDBNull(6) ? default(long) : dataReader.GetInt64(6));
                    UnsafeAccessor_HraBot_Core_Message_Role_Set(instance) = (dataReader.IsDBNull(7) ? default(Role) : ((EnumToNumberConverter<Role, byte>)(((IReadOnlyProperty)(roleProperty)).GetTypeMapping().Converter)).ConvertFromProviderTyped(dataReader.GetByte(7)));
                    UnsafeAccessor_HraBot_Core_Message_Sequence_Set(instance) = (dataReader.IsDBNull(8) ? default(int) : dataReader.GetInt32(8));
                    if (instance is IInjectableService)
                    {
                        ((IInjectableService)(instance)).Injected(materializationContext2.Context, instance, QueryTrackingBehavior.TrackAll, messageEntityType0);
                    }

                    instance2 = instance;
                }
                else
                {
                    instance2 = default(Message);
                }

                entry2 = (entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(entityType2, instance2, in shadowSnapshot2));
            }
        }

        var entity = instance2;
        return entity;
    }, conversationInverseNavigation, (Conversation unnamed1, Message unnamed2) =>
    {
        messagesNavigationCollectionAccessor.Add(unnamed1, unnamed2, true);
        UnsafeAccessor_HraBot_Core_Message_Conversation_Set(unnamed2) = unnamed1;
    }, true);
    return (resultCoordinator.ResultReady ? ((Conversation)(resultContext.Values[0])) : default(Conversation));
}, typeof(HraBotDbContext), false, false, true), queryContext.CancellationToken);
        }

        private static object Query1_Executor;

        #endregion Query1
        #region Unsafe accessors
        [UnsafeAccessor(UnsafeAccessorKind.Field, Name = "<Id>k__BackingField")]
private static extern ref long UnsafeAccessor_HraBot_Core_Conversation_Id_Set(Conversation instance);
        [UnsafeAccessor(UnsafeAccessorKind.Field, Name = "<NumMessages>k__BackingField")]
private static extern ref int UnsafeAccessor_HraBot_Core_Conversation_NumMessages_Set(Conversation instance);
        [UnsafeAccessor(UnsafeAccessorKind.Field, Name = "<RowVersion>k__BackingField")]
private static extern ref byte[] UnsafeAccessor_HraBot_Core_Conversation_RowVersion_Set(Conversation instance);
        [UnsafeAccessor(UnsafeAccessorKind.Field, Name = "<Id>k__BackingField")]
private static extern ref long UnsafeAccessor_HraBot_Core_Message_Id_Set(Message instance);
        [UnsafeAccessor(UnsafeAccessorKind.Field, Name = "<AiModel>k__BackingField")]
private static extern ref AiModel? UnsafeAccessor_HraBot_Core_Message_AiModel_Set(Message instance);
        [UnsafeAccessor(UnsafeAccessorKind.Field, Name = "<Content>k__BackingField")]
private static extern ref string UnsafeAccessor_HraBot_Core_Message_Content_Set(Message instance);
        [UnsafeAccessor(UnsafeAccessorKind.Field, Name = "<ConversationId>k__BackingField")]
private static extern ref long UnsafeAccessor_HraBot_Core_Message_ConversationId_Set(Message instance);
        [UnsafeAccessor(UnsafeAccessorKind.Field, Name = "<Role>k__BackingField")]
private static extern ref Role UnsafeAccessor_HraBot_Core_Message_Role_Set(Message instance);
        [UnsafeAccessor(UnsafeAccessorKind.Field, Name = "<Sequence>k__BackingField")]
private static extern ref int UnsafeAccessor_HraBot_Core_Message_Sequence_Set(Message instance);
        [UnsafeAccessor(UnsafeAccessorKind.Field, Name = "<Conversation>k__BackingField")]
private static extern ref Conversation UnsafeAccessor_HraBot_Core_Message_Conversation_Set(Message instance);
        [UnsafeAccessor(UnsafeAccessorKind.Constructor)]
private static extern Message UnsafeAccessor_HraBot_Core_Message_Ctor();
        #endregion Unsafe accessors
    }
}

namespace System.Runtime.CompilerServices
{
    [AttributeUsage(AttributeTargets.Method, AllowMultiple = true)]
    file sealed class InterceptsLocationAttribute : Attribute
    {
        public InterceptsLocationAttribute(string filePath, int line, int column) { }
    }
}
